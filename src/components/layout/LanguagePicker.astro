---
import { defaultLocale, languageIcons, languages } from "../../i18n/ui";
import { getLangFromUrl, getPathWithoutLang } from "../../i18n/utils";

const locale = getLangFromUrl(Astro.url);

const currentPath = getPathWithoutLang(Astro.url);
const path = currentPath === "" ? "" : `/${currentPath}`;
---

<style>
    label::after {
        content: "";
        display: inline-block;
        border: 0.1rem white solid;
        padding: 0.1rem;
        border-top-color: transparent;
        border-right-color: transparent;
        transform: rotate(-45deg);
        transform-origin: left;
        margin-bottom: 0.3rem;
        margin-left: -1rem;
        pointer-events: none;
    }

    select {
        -webkit-appearance: none;
        -moz-appearance: none;
        appearance: none;
        background: none;
        color: var(--on-surface);
        border: none;
        font-size: 1.3rem;
        padding-right: 1rem;

        @media (width < 500px) {
            font-size: 1rem;
        }
    }
</style>

<div
    x-data={`{
        redirect(value) {
            window.location.href = "${import.meta.env.BASE_URL}" + (value === '${defaultLocale}' ? "${path}" : "/" + value + "${path}");
        }
    }`}
>
    <label for="language">
        <select id="language" @change="redirect($event.target.value)">
            {
                Object.entries(languages).map(([lang, label]) => (
                    <option value={lang} selected={lang === locale}>
                        {label} {languageIcons[lang as keyof typeof languages]}
                    </option>
                ))
            }
        </select>
    </label>
</div>
